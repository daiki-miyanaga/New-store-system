<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê¥ãÁîüÂÆüÁ∏æÂÖ•ÂäõÔºÜÁü≠Êó•„Éé„Éº„Éà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
        }
        
        .back-btn {
            background: #3498db;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
        }
        
        .back-btn:hover {
            background: #2980b9;
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .form-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.5rem;
            text-align: center;
            border-bottom: 1px solid #ddd;
            font-size: 0.9rem;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #219a52;
        }
        
        .note-section {
            margin-top: 2rem;
        }
        
        .note-item {
            background: #fff9c4;
            border-left: 4px solid #f39c12;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 4px 4px 0;
        }
        
        .note-date {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }
        
        .quick-input {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .quick-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            align-items: end;
        }
        
        .quick-input input {
            padding: 0.5rem;
            border: 1px solid #27ae60;
            border-radius: 4px;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }
        
        .hourly-sales {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .hourly-input {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .hourly-input label {
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
            color: #2c3e50;
        }
        
        .hourly-input input {
            width: 60px;
            padding: 0.3rem;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .expiry-tag {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .expiry-critical {
            background: #f8d7da;
            color: #721c24;
        }

        .expiry-warning {
            background: #fff3cd;
            color: #856404;
        }

        .expiry-safe {
            background: #d4edda;
            color: #155724;
        }
        
        /* „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Âº∑Âåñ„Çπ„Çø„Ç§„É´ */
        .validation-error {
            border: 2px solid #dc3545 !important;
            background-color: #f8d7da !important;
        }
        
        .validation-warning {
            border: 2px solid #ffc107 !important;
            background-color: #fff3cd !important;
        }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .alert {
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.375rem;
        }
        
        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffecb5;
        }
        
        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Ê¥ãÁîüÂÆüÁ∏æÂÖ•ÂäõÔºÜÁü≠Êó•„Éé„Éº„Éà</h1>
        <a href="index.html" class="back-btn">‚Üê „É°„Ç§„É≥„É°„Éã„É•„Éº</a>
    </div>
    
    <div class="container">
        <!-- „ÇØ„Ç§„ÉÉ„ÇØÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="form-section">
            <h2>‚ö° „ÇØ„Ç§„ÉÉ„ÇØÂÆüÁ∏æÂÖ•Âäõ</h2>
            <div class="quick-input">
                <div class="quick-input-grid">
                    <div class="form-group">
                        <label>Êó•‰ªò</label>
                        <input type="date" value="2024-01-15">
                    </div>
                    <div class="form-group">
                        <label>ÂïÜÂìÅ„Ç≥„Éº„Éâ</label>
                        <input type="text" placeholder="‰æã: YS001">
                    </div>
                    <div class="form-group">
                        <label>Â£≤‰∏äÊï∞Èáè</label>
                        <input type="number" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Âçò‰æ°</label>
                        <input type="number" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label></label>
                        <button class="btn btn-success">ËøΩÂä†</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- „Éò„ÉÉ„ÉÄÊÉÖÂ†± -->
        <div class="form-section">
            <h2>üìÖ Êó•Ê¨°ÊÉÖÂ†±Ë®≠ÂÆö</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Êó•‰ªò</label>
                    <input type="date" value="2024-01-15">
                </div>
                <div class="form-group">
                    <label>ÂÆ¢Êï∞</label>
                    <input type="number" placeholder="60" value="60">
                </div>
                <div class="form-group">
                    <label>Â§©Ê∞ó</label>
                    <select>
                        <option>Êô¥„Çå</option>
                        <option>Êõá„Çä</option>
                        <option>Èõ®</option>
                        <option>Èõ™</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ê∞óÊ∏©Ôºà‚ÑÉÔºâ</label>
                    <input type="number" placeholder="15" value="15">
                </div>
                <div class="form-group">
                    <label>ÁâπÊãõ‰ºö„Éª„Ç§„Éô„É≥„Éà</label>
                    <select>
                        <option>„Å™„Åó</option>
                        <option>ÁâπÊãõ‰ºö</option>
                        <option>„Çª„Éº„É´</option>
                        <option>Êñ∞ÂïÜÂìÅÁô∫Â£≤</option>
                        <option>Á´∂ÂêàÂÇ¨‰∫ã</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- ÂïÜÂìÅÂà•ÂÆüÁ∏æÂÖ•Âäõ„Ç∞„É™„ÉÉ„Éâ -->
        <div class="form-section">
            <h2>üìù ÂïÜÂìÅÂà•ÂÆüÁ∏æÂÖ•Âäõ</h2>
            <div style="margin-bottom: 1rem;">
                <button class="btn btn-success">‚ûï ÂïÜÂìÅËøΩÂä†</button>
                <button class="btn btn-primary">üìã „ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ©Áî®</button>
                <button class="btn btn-primary">üîÑ Ëá™ÂãïË®àÁÆó</button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ÂïÜÂìÅ„Ç≥„Éº„Éâ</th>
                            <th>ÂïÜÂìÅÂêç</th>
                            <th>Âçò‰æ°</th>
                            <th>„Ç´„ÉÜ„Ç¥„É™</th>
                            <th>ÂâçÊó•ÊÆã<br><small>(ÊåÅË∂ä„Åó)</small></th>
                            <th>ÂΩìÊó•ÂÖ•Â∫´</th>
                            <th>ÁßªÂãï</th>
                            <th>Ë≤©Â£≤Êï∞</th>
                            <th>„É≠„ÇπÊï∞</th>
                            <th>ÂΩìÊó•Âú®Â∫´<br><small>(Ëá™Âãï)</small></th>
                            <th>ÈñâÂ∫óÊôÇÂú®Â∫´<br><small>(EOD)</small></th>
                            <th>ÁâπÊ≥®</th>
                            <th>ÂÆåÂ£≤ÊôÇÈñì</th>
                            <th>Â£≤‰∏äÈ°ç</th>
                            <th>ÊßãÊàêÊØî</th>
                            <th>Ê∂àË≤ªÊúüÈôê</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" style="width: 80px;" value="YS001"></td>
                            <td><input type="text" style="width: 120px;" value="„Ç∑„Éß„Éº„Éà„Ç±„Éº„Ç≠"></td>
                            <td><input type="number" style="width: 80px;" value="380"></td>
                            <td>
                                <select style="width: 80px;">
                                    <option>„Ç±„Éº„Ç≠</option>
                                    <option>„Éó„É™„É≥</option>
                                    <option>„Çº„É™„Éº</option>
                                </select>
                            </td>
                            <td><input type="number" style="width: 60px;" value="8"></td>
                            <td><input type="number" style="width: 60px;" value="35"></td>
                            <td><input type="number" style="width: 60px;" value="0"></td>
                            <td><input type="number" style="width: 60px;" value="35"></td>
                            <td><input type="number" style="width: 60px;" value="2"></td>
                            <td style="background: #f0f0f0;">6</td>
                            <td><input type="number" style="width: 60px;" value="6"></td>
                            <td><input type="number" style="width: 60px;" value="3"></td>
                            <td><input type="time" style="width: 80px;" value="18:30"></td>
                            <td style="background: #f0f0f0;">¬•13,300</td>
                            <td style="background: #f0f0f0;">22.1%</td>
                            <td><span class="expiry-tag expiry-warning">ÊòéÊó•„Åæ„Åß</span></td>
                            <td>
                                <button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">Ë§áË£Ω</button>
                                <button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">ÂâäÈô§</button>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="text" style="width: 80px;" value="YS002"></td>
                            <td><input type="text" style="width: 120px;" value="„ÉÅ„Éº„Ç∫„Ç±„Éº„Ç≠"></td>
                            <td><input type="number" style="width: 80px;" value="420"></td>
                            <td>
                                <select style="width: 80px;">
                                    <option>„Ç±„Éº„Ç≠</option>
                                    <option>„Éó„É™„É≥</option>
                                    <option>„Çº„É™„Éº</option>
                                </select>
                            </td>
                            <td><input type="number" style="width: 60px;" value="5"></td>
                            <td><input type="number" style="width: 60px;" value="25"></td>
                            <td><input type="number" style="width: 60px;" value="2"></td>
                            <td><input type="number" style="width: 60px;" value="28"></td>
                            <td><input type="number" style="width: 60px;" value="1"></td>
                            <td style="background: #f0f0f0;">3</td>
                            <td><input type="number" style="width: 60px;" value="3"></td>
                            <td><input type="number" style="width: 60px;" value="1"></td>
                            <td><input type="time" style="width: 80px;" value="19:15"></td>
                            <td style="background: #f0f0f0;">¬•11,760</td>
                            <td style="background: #f0f0f0;">19.5%</td>
                            <td><span class="expiry-tag expiry-safe">‰ΩôË£ï„ÅÇ„Çä</span></td>
                            <td>
                                <button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">Ë§áË£Ω</button>
                                <button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">ÂâäÈô§</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
                <strong>ÂêàË®àÊÉÖÂ†±:</strong> Â£≤‰∏äÈ°ç: ¬•60,280 | Á∑èË≤©Â£≤Êï∞: 134ÂÄã | Á∑è„É≠„ÇπÊï∞: 8ÂÄã | „É≠„ÇπÁéá: 5.6%
            </div>
        </div>
        
        <!-- ÊôÇÈñìÂ∏ØÂà•Â£≤‰∏ä -->
        <div class="form-section">
            <h2>üïê ÊôÇÈñìÂ∏ØÂà•Â£≤‰∏äÂÖ•Âäõ</h2>
            <div style="margin-bottom: 1rem;">
                <button class="btn btn-success">‚ûï ÊôÇÈñìËøΩÂä†</button>
                <button class="btn btn-primary">üìà „Ç∞„É©„ÉïË°®Á§∫</button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ÊôÇÈñì</th>
                            <th>Â£≤‰∏äÈ°ç</th>
                            <th>ÊßãÊàêÊØî</th>
                            <th>Á¥ØË®à</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>09:00-10:00</td>
                            <td><input type="number" style="width: 100px;" placeholder="Â£≤‰∏äÈ°ç" value="3200"></td>
                            <td style="background: #f0f0f0;">5.3%</td>
                            <td style="background: #f0f0f0;">¬•3,200</td>
                            <td><button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">ÂâäÈô§</button></td>
                        </tr>
                        <tr>
                            <td>10:00-11:00</td>
                            <td><input type="number" style="width: 100px;" placeholder="Â£≤‰∏äÈ°ç" value="4800"></td>
                            <td style="background: #f0f0f0;">8.0%</td>
                            <td style="background: #f0f0f0;">¬•8,000</td>
                            <td><button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">ÂâäÈô§</button></td>
                        </tr>
                        <tr>
                            <td>11:00-12:00</td>
                            <td><input type="number" style="width: 100px;" placeholder="Â£≤‰∏äÈ°ç" value="7200"></td>
                            <td style="background: #f0f0f0;">12.0%</td>
                            <td style="background: #f0f0f0;">¬•15,200</td>
                            <td><button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">ÂâäÈô§</button></td>
                        </tr>
                        <tr>
                            <td>14:00-15:00</td>
                            <td><input type="number" style="width: 100px;" placeholder="Â£≤‰∏äÈ°ç" value="9600"></td>
                            <td style="background: #f0f0f0;">16.0%</td>
                            <td style="background: #f0f0f0;">¬•24,800</td>
                            <td><button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;">ÂâäÈô§</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
                <strong>ÊôÇÈñìÂ∏ØÂêàË®à:</strong> ¬•60,280 | „Éî„Éº„ÇØÊôÇÈñì: 14:00-15:00 (¬•9,600)
            </div>
        </div>
        
        <!-- „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç¢„É©„Éº„Éà -->
        <div class="form-section">
            <h2>‚ö†Ô∏è „Ç¢„É©„Éº„Éà„ÉªÊ≥®ÊÑè‰∫ãÈ†Ö</h2>
            <div style="display: grid; gap: 1rem;">
                <div class="alert alert-warning">
                    <strong>„É≠„ÇπÁéáË≠¶Âëä:</strong> „Éï„É´„Éº„ÉÑ„Çø„É´„Éà„ÅÆ„É≠„ÇπÁéá„Åå8.0%„Åß„ÄÅÂü∫Ê∫ñÂÄ§(5%)„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                </div>
                <div class="alert alert-info">
                    <strong>ÂÆåÂ£≤ÊôÇÈñìÊú™ÂÖ•Âäõ:</strong> 3ÂïÜÂìÅ„ÅÆÂÆåÂ£≤ÊôÇÈñì„ÅåÊú™ÂÖ•Âäõ„Åß„Åô„ÄÇÂÖ•Âäõ„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ
                </div>
            </div>
        </div>
        
        <!-- Áü≠Êó•„Éé„Éº„Éà -->
        <div class="form-section">
            <h2>üìñ Áü≠Êó•„Éé„Éº„Éà</h2>
            <div class="form-group">
                <label>‰ªäÊó•„ÅÆ„É°„É¢„ÉªÊ∞ó„Å•„Åç</label>
                <textarea placeholder="Êú¨Êó•„ÅÆÂ£≤‰∏äÁä∂Ê≥Å„ÄÅÂÆ¢Â±§„ÅÆÂ§âÂåñ„ÄÅÂïÜÂìÅ„ÅÆÂãïÂêë„Å™„Å©„ÄÅÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„ÇíË®òÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
            </div>
            
            <div class="note-section">
                <h3>ÈÅéÂéª„ÅÆ„Éé„Éº„Éà</h3>
                <div class="note-item">
                    <div class="note-date">2024-01-14 16:30</div>
                    <div>ÂçàÂæå„Åã„Çâ„ÅÆÈõ®„ÅßÂÆ¢Ë∂≥„ÅåÊ∏õÂ∞ë„ÄÇ„Ç∑„Éß„Éº„Éà„Ç±„Éº„Ç≠„ÅÆÂ£≤„ÇåË°å„Åç„ÅåÂ•ΩË™ø„Åß„ÄÅ‰∫àÂÆö„Çà„Çä2ÊôÇÈñìÊó©„ÅèÂÆåÂ£≤„ÄÇÊòéÊó•„ÅØÂ§ö„ÇÅ„Å´Ê∫ñÂÇô„ÇíÊ§úË®é„ÄÇ</div>
                </div>
                <div class="note-item">
                    <div class="note-date">2024-01-13 17:45</div>
                    <div>Êñ∞ÂïÜÂìÅ„ÅÆ„Éï„É´„Éº„ÉÑ„Çø„É´„Éà„ÅåÂ•ΩË©ï„ÄÇÁâπ„Å´Â•≥ÊÄßÂÆ¢„Åã„Çâ„ÅÆÂèçÂøú„ÅåËâØ„ÅÑ„ÄÇÈÄ±Êú´„Å´Âêë„Åë„Å¶Âú®Â∫´„ÇíÂ¢ó„ÇÑ„ÅôÊñπÂêë„ÅßÊ§úË®é„ÄÇ</div>
                </div>
            </div>
        </div>
        
        <div class="btn-group">
            <button class="btn btn-success">üíæ „Éá„Éº„Çø„Çí‰øùÂ≠ò</button>
            <button class="btn btn-primary">üìä Êó•Â†±„ÇíÁîüÊàê</button>
            <button class="btn btn-primary">üìà „Ç∞„É©„ÉïË°®Á§∫</button>
        </div>
    </div>
    
    <script>
        // „É™„Ç¢„ÇØ„ÉÜ„Ç£„ÉñË®àÁÆóÊ©üËÉΩ
        function updateCalculations() {
            const rows = document.querySelectorAll('.data-table tbody tr');
            let totalSales = 0;
            let totalItems = 0;
            let totalWaste = 0;
            let validationErrors = [];
            
            rows.forEach((row, index) => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 10) {
                    // ÂâçÊó•ÊÆã + ÂΩìÊó•ÂÖ•Â∫´ - Ë≤©Â£≤Êï∞ - „É≠„ÇπÊï∞ = ÂΩìÊó•Âú®Â∫´„ÅÆËá™ÂãïË®àÁÆó
                    const prevStock = parseInt(cells[4].querySelector('input').value) || 0;
                    const delivery = parseInt(cells[5].querySelector('input').value) || 0;
                    const movement = parseInt(cells[6].querySelector('input').value) || 0;
                    const sales = parseInt(cells[7].querySelector('input').value) || 0;
                    const waste = parseInt(cells[8].querySelector('input').value) || 0;
                    const unitPrice = parseInt(cells[2].querySelector('input').value) || 0;
                    const productName = cells[1].querySelector('input').value;
                    const soldoutTime = cells[12].querySelector('input').value;
                    
                    // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Âá¶ÁêÜ
                    validateRow(cells, index, productName, prevStock, delivery, movement, sales, waste, soldoutTime, validationErrors);
                    
                    // ÂΩìÊó•Âú®Â∫´„ÅÆËá™ÂãïÊõ¥Êñ∞Ôºà‰ªïÊßòÊõ∏„ÅÆË®àÁÆóÂºèÔºâ
                    const currentStock = prevStock + delivery + movement - sales - waste;
                    cells[9].textContent = currentStock;
                    
                    // ÊßãÊàêÊØîË®àÁÆó„ÅÆ„Åü„ÇÅ„ÅÆÂ£≤‰∏äÈ°çË®àÁÆó
                    const salesAmount = sales * unitPrice;
                    cells[13].textContent = '¬•' + salesAmount.toLocaleString();
                    
                    totalSales += salesAmount;
                    totalItems += sales;
                    totalWaste += waste;
                }
            });
            
            // ÊßãÊàêÊØî„ÅÆË®àÁÆó
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 10) {
                    const sales = parseInt(cells[7].querySelector('input').value) || 0;
                    const unitPrice = parseInt(cells[2].querySelector('input').value) || 0;
                    const salesAmount = sales * unitPrice;
                    const share = totalSales > 0 ? ((salesAmount / totalSales) * 100).toFixed(1) : 0;
                    cells[14].textContent = share + '%';
                }
            });
            
            // ÂêàË®àÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
            const wasteRate = (totalItems + totalWaste) > 0 ? ((totalWaste / (totalItems + totalWaste)) * 100).toFixed(1) : 0;
            const summaryElement = document.querySelector('.data-table + div');
            if (summaryElement) {
                summaryElement.innerHTML = `<strong>ÂêàË®àÊÉÖÂ†±:</strong> Â£≤‰∏äÈ°ç: ¬•${totalSales.toLocaleString()} | Á∑èË≤©Â£≤Êï∞: ${totalItems}ÂÄã | Á∑è„É≠„ÇπÊï∞: ${totalWaste}ÂÄã | „É≠„ÇπÁéá: ${wasteRate}%`;
            }
            
            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç¢„É©„Éº„Éà„ÅÆÊõ¥Êñ∞
            updateValidationAlerts(validationErrors);
        }
        
        // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Âá¶ÁêÜÔºà‰ªïÊßòÊõ∏DAIRY-001Ê∫ñÊã†Ôºâ
        function validateRow(cells, index, productName, prevStock, delivery, movement, sales, waste, soldoutTime, errors) {
            // „É≠„ÇπÊØîÁéá„ÅÆÁï∞Â∏∏ÂÄ§„ÉÅ„Çß„ÉÉ„ÇØÔºàÂü∫Ê∫ñÂÄ§5%Ôºâ
            const totalHandled = sales + waste;
            if (totalHandled > 0) {
                const wasteRate = (waste / totalHandled) * 100;
                if (wasteRate > 5.0) {
                    cells[8].querySelector('input').classList.add('validation-warning');
                    errors.push(`${productName}: „É≠„ÇπÁéá„ÅåÂü∫Ê∫ñÂÄ§(5%)„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô (${wasteRate.toFixed(1)}%)`);
                } else {
                    cells[8].querySelector('input').classList.remove('validation-warning');
                }
                
                // Áï∞Â∏∏„Å´È´ò„ÅÑ„É≠„ÇπÁéáÔºà15%‰ª•‰∏äÔºâ
                if (wasteRate > 15.0) {
                    cells[8].querySelector('input').classList.add('validation-error');
                    errors.push(`${productName}: „É≠„ÇπÁéá„ÅåÁï∞Â∏∏„Å´È´òÂÄ§„Åß„Åô (${wasteRate.toFixed(1)}%)`);
                }
            }
            
            // ÂÆåÂ£≤ÊôÇÈñì„ÅÆÁØÑÂõ≤„ÉÅ„Çß„ÉÉ„ÇØÔºà00:00‚Äì23:59Ôºâ
            if (soldoutTime) {
                const timePattern = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;
                if (!timePattern.test(soldoutTime)) {
                    cells[12].querySelector('input').classList.add('validation-error');
                    errors.push(`${productName}: ÂÆåÂ£≤ÊôÇÈñì„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì (HH:MMÂΩ¢Âºè„ÅßÂÖ•Âäõ)`);
                } else {
                    cells[12].querySelector('input').classList.remove('validation-error');
                }
            }
            
            // Âú®Â∫´„Éû„Ç§„Éä„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
            const currentStock = prevStock + delivery + movement - sales - waste;
            if (currentStock < 0) {
                [cells[7].querySelector('input'), cells[8].querySelector('input')].forEach(input => {
                    input.classList.add('validation-error');
                });
                errors.push(`${productName}: Âú®Â∫´„Åå„Éû„Ç§„Éä„Çπ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇË≤©Â£≤Êï∞„Åæ„Åü„ÅØ„É≠„ÇπÊï∞„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ`);
            }
            
            // ÂÆåÂ£≤ÂïÜÂìÅ„ÅÆÂÆåÂ£≤ÊôÇÈñìÊú™ÂÖ•Âäõ„ÉÅ„Çß„ÉÉ„ÇØ
            if (currentStock === 0 && sales > 0 && !soldoutTime) {
                cells[12].querySelector('input').classList.add('validation-warning');
                errors.push(`${productName}: ÂÆåÂ£≤„Åó„Å¶„ÅÑ„Çã„Çà„ÅÜ„Åß„Åô„ÅåÂÆåÂ£≤ÊôÇÈñì„ÅåÊú™ÂÖ•Âäõ„Åß„Åô`);
            }
        }
        
        // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç¢„É©„Éº„Éà„ÅÆÊõ¥Êñ∞
        function updateValidationAlerts(errors) {
            const alertSection = document.querySelector('.form-section h2:contains("„Ç¢„É©„Éº„Éà") + div');
            if (!alertSection) return;
            
            alertSection.innerHTML = '';
            
            if (errors.length === 0) {
                alertSection.innerHTML = '<div class="alert alert-info"><strong>‚úì „Éê„É™„Éá„Éº„Ç∑„Éß„É≥:</strong> „Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÅåÊ≠£Â∏∏„Åß„Åô„ÄÇ</div>';
                return;
            }
            
            errors.forEach(error => {
                const alertDiv = document.createElement('div');
                if (error.includes('Áï∞Â∏∏')) {
                    alertDiv.className = 'alert alert-danger';
                    alertDiv.innerHTML = `<strong>üö® „Ç®„É©„Éº:</strong> ${error}`;
                } else {
                    alertDiv.className = 'alert alert-warning';
                    alertDiv.innerHTML = `<strong>‚ö†Ô∏è Ë≠¶Âëä:</strong> ${error}`;
                }
                alertSection.appendChild(alertDiv);
            });
        }
        
        // ÊôÇÈñìÂ∏ØÂà•Â£≤‰∏ä„ÅÆËá™ÂãïË®àÁÆó
        function updateHourlySales() {
            const hourlyRows = document.querySelectorAll('table:last-of-type tbody tr');
            let totalHourly = 0;
            
            hourlyRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) {
                    const salesInput = cells[1].querySelector('input');
                    if (salesInput) {
                        const amount = parseInt(salesInput.value) || 0;
                        totalHourly += amount;
                    }
                }
            });
            
            // ÊßãÊàêÊØî„Å®Á¥ØË®à„ÅÆË®àÁÆó
            let cumulative = 0;
            hourlyRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) {
                    const salesInput = cells[1].querySelector('input');
                    if (salesInput) {
                        const amount = parseInt(salesInput.value) || 0;
                        cumulative += amount;
                        
                        // ÊßãÊàêÊØî
                        const share = totalHourly > 0 ? ((amount / totalHourly) * 100).toFixed(1) : 0;
                        cells[2].textContent = share + '%';
                        
                        // Á¥ØË®à
                        cells[3].textContent = '¬•' + cumulative.toLocaleString();
                    }
                }
            });
            
            // ÊôÇÈñìÂ∏ØÂêàË®à„ÅÆÊõ¥Êñ∞
            const hourlySummary = document.querySelector('.form-section:last-of-type .data-table + div');
            if (hourlySummary) {
                // „Éî„Éº„ÇØÊôÇÈñì„ÅÆÁâπÂÆö
                let peakTime = '';
                let peakAmount = 0;
                hourlyRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length > 1) {
                        const timeSlot = cells[0].textContent;
                        const amount = parseInt(cells[1].querySelector('input')?.value) || 0;
                        if (amount > peakAmount) {
                            peakAmount = amount;
                            peakTime = timeSlot;
                        }
                    }
                });
                
                hourlySummary.innerHTML = `<strong>ÊôÇÈñìÂ∏ØÂêàË®à:</strong> ¬•${totalHourly.toLocaleString()} | „Éî„Éº„ÇØÊôÇÈñì: ${peakTime} (¬•${peakAmount.toLocaleString()})`;
            }
        }
        
        // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'INPUT') {
                // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
                e.target.classList.remove('validation-error', 'validation-warning');
                
                if (e.target.type === 'number' || e.target.type === 'time') {
                    updateCalculations();
                    updateHourlySales();
                }
            }
        });
        
        // ÂïÜÂìÅËøΩÂä†Ê©üËÉΩ
        function addProductRow() {
            const tbody = document.querySelector('.data-table tbody');
            const newRow = tbody.querySelector('tr').cloneNode(true);
            
            // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„Ç¢
            newRow.querySelectorAll('input').forEach(input => {
                input.value = '';
                input.classList.remove('validation-error', 'validation-warning');
            });
            newRow.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });
            
            tbody.appendChild(newRow);
            updateCalculations();
        }
        
        // ÊôÇÈñìÂ∏ØËøΩÂä†Ê©üËÉΩ
        function addHourlyRow() {
            const tbody = document.querySelector('table:last-of-type tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" style="width: 100px;" placeholder="HH:MM-HH:MM"></td>
                <td><input type="number" style="width: 100px;" placeholder="Â£≤‰∏äÈ°ç"></td>
                <td style="background: #f0f0f0;">0.0%</td>
                <td style="background: #f0f0f0;">¬•0</td>
                <td><button class="btn btn-primary" style="padding: 0.2rem 0.4rem; font-size: 0.7rem;" onclick="this.closest('tr').remove(); updateHourlySales();">ÂâäÈô§</button></td>
            `;
            tbody.appendChild(newRow);
        }
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateCalculations();
            updateHourlySales();
            
            // „Éú„Çø„É≥„Ç§„Éô„É≥„Éà„ÅÆË®≠ÂÆö
            document.querySelector('button:contains("ÂïÜÂìÅËøΩÂä†")')?.addEventListener('click', addProductRow);
            document.querySelector('button:contains("ÊôÇÈñìËøΩÂä†")')?.addEventListener('click', addHourlyRow);
        });
    </script>
</body>
</html>